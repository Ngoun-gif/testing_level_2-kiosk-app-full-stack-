<div class="m2">

  <!-- TOP ICON CATEGORY ROW -->
  <div class="m2-top">
    <div class="m2-catbar">
      <button v-for="c in safeCategories" :key="c.id" class="m2-cat"
        :class="{ active: Number(store.catalog.categoryId) === Number(c.id) }" @click="selectCategory(c.id)"
        type="button">
        <img class="m2-catimg" :src="img(c)" @error="e=>e.target.src='./assets/placeholder.png'" alt="">
        <div class="m2-catname">{{ c.name }}</div>
      </button>
    </div>
  </div>

  <!-- SUB CATEGORY PILL ROW -->
  <div class="m2-subwrap">
    <div class="m2-subbar">
      <button v-for="s in safeSubCategories" :key="s.id" class="m2-pill"
        :class="{ active: Number(store.catalog.subCategoryId) === Number(s.id) }" @click="selectSubCategory(s.id)"
        type="button">
        <img class="m2-pillicon" :src="img(s)" @error="e=>e.target.src='./assets/placeholder.png'" alt="">
        <span>{{ s.name }}</span>
      </button>
    </div>
  </div>

  <!-- PRODUCT GRID -->
  <div class="m2-body">
    <div class="m2-grid">
      <button v-for="p in safeProducts" :key="p.id" class="m2-card" @click="openProduct(p)" type="button">
        <div class="m2-prdimgwrap">
          <img class="m2-prdimg" :src="img(p)" @error="e=>e.target.src='./assets/placeholder.png'" alt="">

          <div v-if="(cartQtyByProduct[Number(p.id)] || 0) > 0" class="m2-prdbadge">
            {{ cartQtyByProduct[Number(p.id)] }}
          </div>
        </div>

        <div class="m2-prdname">{{ p.name }}</div>
        <div class="m2-prdprice">$ {{ Number(p.base_price || 0).toFixed(2) }}</div>
      </button>

    </div>

    <div v-if="!safeProducts.length && !store.loading" class="m2-empty">
      No products
    </div>
  </div>

  <!-- BOTTOM BAR -->
  <div class="m2-footer">
    <button class="m2-back" type="button" @click="goService">Back</button>

    <div class="m2-total">
      <div class="m2-total-label">Total</div>
      <div class="m2-total-row">
        <div class="m2-bubble">{{ count }}</div>
        <div class="m2-total-amount">$ {{ total.toFixed(2) }}</div>
      </div>
    </div>

    <button class="m2-checkout" type="button" :disabled="count===0" @click="goCheckout">
      Checkout
    </button>
  </div>

</div>